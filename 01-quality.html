<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>TIB2017: NGS – from fastq to variant annotation</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="PBI - Transcriptomica" href="http://bi.ira.cinvestav.mx:8282/"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="https://mxbiobankworkshop.wordpress.com/" title="Practical workshop on Large-Scale
            Genomic Data Analyses: GWAS in structured populations">
          <img alt="MX Biobank Logo" src="img/mxbiobank_logo_reduced.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">NGS – from fastq to variant annotation</h1></a>
          <h2 class="subtitle">Quality control of NGS data</h2>
          <section class="objectives panel panel-warning">
<div class="panel-heading">
<h2 id="learning-objectives"><span class="glyphicon glyphicon-certificate"></span>Learning objectives</h2>
</div>
<div class="panel-body">
<ul>
<li>Understand the FastQ format.</li>
<li>Understand the concept of sequence quality.</li>
<li>Learn how to use software to measure and improve the quality of massive sequencing data.</li>
</ul>
</div>
</section>
<h2 id="downloading-the-data">Downloading the data</h2>
<p>The first thing we do when receiving our data is to download them. They are usually in a compressed format. We can decompress the data using the <code>unzip</code> command:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">unzip</span> <span class="st">&#39;Alignment&amp;VariantCalling.zip&#39;</span></code></pre></div>
<p>This command decompresses a directory called <code>FastQC_Short</code>. We enter that directory:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">cd</span> VariantCalling</code></pre></div>
<p>Revise its contents:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">ls</span></code></pre></div>
<pre class="output"><code>lane1  lane2  mito.intervals  Saccharomyces_cerevisiae.EF4.68.dna.toplevel.fa</code></pre>
<p>We will now look at the contents of the two “lane” directories:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">ls</span> lane*</code></pre></div>
<pre class="output"><code>lane1:
s-7-1.fastq  s-7-2.fastq

lane2:
s-7-1.fastq  s-7-2.fastq</code></pre>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2 id="the-name-of-fastq-files"><span class="glyphicon glyphicon-pushpin"></span>The name of fastq files</h2>
</div>
<div class="panel-body">
<p>In this case, the name of the files has been assigned in a arbitrary but often contain important information. For example, the Illumina files generally have the following format:</p>
<pre class="output"><code>&lt;sample name&gt;_&lt;barcode&gt;_L&lt;lane(3 digits)&gt;_R&lt;read&gt;_&lt;set number (3 digits)&gt;.fastq.gz</code></pre>
<p>Example: NA10831_ATCACG_L002_R1_001.fastq.gz</p>
<p>It is ideal to respect these names to avoid losing information.</p>
</div>
</aside>
<p>Let’s review one of the files using the head command. It usually shows us the first 10 lines of a file but with the <code>-n</code> flag will show us the first 12:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">head</span> -n 12 ./lane1/s-7-1.fastq</code></pre></div>
<pre class="output"><code>@IL29_4505:7:24:8932:6562#2/1
TAACGGTGGGTGAGTGGTAGTAAGTAGAGGGATGGATGGTGGTTCGGAGTGGTATGGTTGAATGGGACAGGGTAACGAGTGGAGAGTAGGGTAATGGAGGGTAAGTTC
+
CDDCDDABBBABABABB@BCACBDABCBBAB@BBCABBBABB?CBCCABABBABBBBABA?ACBAAAAA?BB;BCAABA7AA?B?A??AAA&gt;?A:AA?AA?%?AA@=9
@IL29_4505:7:15:7929:11873#2/1
TTAACGTTTCAATATGGTAGGTAGAACAACAGTACAGTGAGTGGGACATGGTGGATGGTAAAAGAATGGTAGGGTAAGTGGCAGTGGGGTTGGATATGGGTAATTGGA
+
DDDDDDCDDCDDDDCCDBDDDACCCCCCCDCCBCDCCBCBCACCCBCBCCCACCACCCAAABABAABBC?ABBA=BBA?BAAAB?BABA7AAB?AAAAA@:A?AA?B-
@IL29_4505:7:109:18599:8300#2/1
CTTACCCTCCATTACCCTACCTCCACTCGTTACCCTGTCCCATTCAACCATACCACTCCGAACCACCATCCATCCCTCTACTTACTACCACTCACCCACCGTTACCCT
+
D?BDCABBBABBDACCBBDCDCBBBBABBBCDABBBABBBBBCBA@ABCBCBB@BB0=BB4&gt;&lt;B:BABAABBABA@AB=BB?ACBABA?AB;BBBABBBB&#39;0=CB9&lt;9</code></pre>
<p>This file is in <code>fastq</code> format. This is the format that most modern sequencing platforms generate. This format is a modification of the sequence format <a href="https://en.wikipedia.org/wiki/FASTA_format">Fasta</a>. You can recognize them because they end with the extension <code>.fq</code> or <code>.fastq</code>.</p>
<p>FastQ files are plain ASCII text files that contain both the sequences detected by the sequencer as well as information about the quality of each one of the sequenced nucleotides.</p>
<aside class="callout panel panel-info">
<div class="panel-heading">
<h2 id="do-not-change-fastq-files"><span class="glyphicon glyphicon-pushpin"></span>Do not change fastq files!</h2>
</div>
<div class="panel-body">
<p>The fastq files that you receive after a sequencing experiment will be requested when you want to publish an article. Ideally, make a couple of copies on different devices as soon as you receive them and <em>do not modify them manually</em>.</p>
<p>It is also recommended that, if you have the information at hand, you create a small README file (plain text) that is in the same directory as your fastq files and describe how the experiment was performed, how many replicas there are of each condition, which indexes and controls were used, etc. This will help you greatly when trying to interpret your results.</p>
</div>
</aside>
<p>We will take a single sequence as an example:</p>
<pre class="output"><code>@IL29_4505:7:24:8932:6562#2/1
TAACGGTGGGTGAGTGGTAGTAAGTAGAGGGATGGATGGTGGTTCGGAGTGGTATGGTTGAATGGGACAGGGTAACGAGTGGAGAGTAGGGTAATGGAGGGTAAGTTC
+
CDDCDDABBBABABABB@BCACBDABCBBAB@BBCABBBABB?CBCCABABBABBBBABA?ACBAAAAA?BB;BCAABA7AA?B?A??AAA&gt;?A:AA?AA?%?AA@=9</code></pre>
<p>We see that each sequence is represented by 4 lines.</p>
<ol style="list-style-type: decimal">
<li><strong>Sequence name</strong> - This line begins with the symbol <code>@</code>, followed by the read name.</li>
<li>The nucleotide <strong>sequence</strong>.</li>
<li><strong>Segundo título</strong> - Esta línea comienza con el símbolo <code>+</code>. Generally the information is the same as in the first line but it can also be blank as long as it begins with the symbol <code>+</code>.</li>
<li><strong>Quality information</strong> - It contains an ASCII character string. Every one of these characters corresponds to a nucleotide of the sequence and represents the quality of the same. The score of each nucleotide indicates the level of confidence that you have in that base. High levels indicate that the base has been reported correctly while low levels suggest that there is uncertainty about the actual sequence in this position.</li>
</ol>
<p>The name of the sequence also contains important information. In In this case, the Illumina data provide the following information:</p>
<pre class="output"><code>@&lt;instrument&gt;:&lt;run&gt;:&lt;flow cell identifier&gt;:&lt;lane&gt;:&lt;square&gt;:&lt;x-coord&gt;:&lt;y-coord&gt; &lt;read&gt;:&lt;if the ead was filtered&gt;:&lt;control number&gt;:&lt;sequence index&gt; length=&lt;sequence size&gt;</code></pre>
<p>The level of quality represented in the fourth line is called Phred score. In its original format a Phred score is simply the logarithm of the probabilities of error:</p>
<pre class="output"><code>Phred score = - 10 * log10(error probability)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">Quality score</th>
<th align="left">Error probability</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Q40 0.0001</td>
<td align="left">(1 en 10,000)</td>
</tr>
<tr class="even">
<td align="left">Q30 0.001</td>
<td align="left">(1 en 1,000)</td>
</tr>
<tr class="odd">
<td align="left">Q20 0.01</td>
<td align="left">(1 en 100)</td>
</tr>
<tr class="even">
<td align="left">Q10 0.1</td>
<td align="left">(1 en 10)</td>
</tr>
</tbody>
</table>
<p>Wait, if the Phred scores are numbers, why do the quality scores shown in line four are a mixture of alphanumeric symbols?</p>
<pre class="output"><code>#1:=BDDDHDHB?&lt;?CFGGGC9@FF@GGGG&gt;EEEDGDHGFHGE;AEFH&gt;AC@D;@B&gt;C&gt;CCC@C&gt;&gt;DDCC3:&gt;AA5&gt;CC&gt;&gt;CCD&gt;@CCDCDCCCCC@C@&gt;C</code></pre>
<p>This is because these scores are encoded in ASCII (American Standard Code for Informational Interchange). In short, ASCII is a coding system that equates a number to a character alphanumeric. For example, the character ‘A’ is represented by the number 65 in the table ASCII code, while ‘%’ is represented by the number 37. This system allows us to represent a total of 256 different characters.</p>
<p>Why use ASCII? Given the huge amount of data produced during massive parallel sequencing, it’s all about reducing the data to the maximum. The ASCII system allows us to represent two-digit numbers in a single bit (8 bits), which reduces the space they occupy these files. If you are interested in the subject, you can read more about binary coding.</p>
<p>Finally, since this quality coding system was invented, which is already used with Sanger-type sequencing, different companies have “slipped” the scales of ASCII conversion because what is important to verify with the company or laboratory in which version of this scale have been coded to use the correct conversion. Some of the quality control tools that we will use infer the type of coding used directly from the data provided.</p>
<h2 id="verifying-the-quality-of-the-sequences">Verifying the quality of the sequences</h2>
<p>We will verify the quality of the sequences using the program <a href="http://www.bioinformatics.babraham.ac.uk/projects/fastqc/">FastQC</a>. This is one of the most used programs for this type of analysis, since it provides a global vision of how the data is structured, as well as being pretty fast.</p>
<p>FastQC reads a series of sequencing files and produces a report of quality control for each one, which consists of a number of different modules, each of which helps us identify different problems in our data.</p>
<p>Let’s analyze our first sequencing file, first we created a directory to store our results:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">mkdir</span> QUAL</code></pre></div>
<p>And we perform our quality analysis using FastQC:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">fastqc</span> -O ./QUAL/ lane1/s-7-1.fastq</code></pre></div>
<pre class="output"><code>Started analysis of s-7-1.fastq
Approx 5% complete for s-7-1.fastq
Approx 10% complete for s-7-1.fastq
Approx 15% complete for s-7-1.fastq
Approx 20% complete for s-7-1.fastq
Approx 25% complete for s-7-1.fastq
Approx 30% complete for s-7-1.fastq
Approx 35% complete for s-7-1.fastq
Approx 40% complete for s-7-1.fastq
Approx 45% complete for s-7-1.fastq
Approx 50% complete for s-7-1.fastq
Approx 55% complete for s-7-1.fastq
Approx 60% complete for s-7-1.fastq
Approx 65% complete for s-7-1.fastq
Approx 70% complete for s-7-1.fastq
Approx 75% complete for s-7-1.fastq
Approx 80% complete for s-7-1.fastq
Approx 85% complete for s-7-1.fastq
Approx 90% complete for s-7-1.fastq
Approx 95% complete for s-7-1.fastq
Analysis complete for s-7-1.fastq</code></pre>
<p>Once finished, let’s review the result:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">cd</span> QUAL
$ <span class="kw">ls</span></code></pre></div>
<pre class="output"><code>s-7-1_fastqc.html  s-7-1_fastqc.zip</code></pre>
<p>The easiest way to explore these results is by opening the html file in your browser. You can do it by double clicking on the file.</p>
<p>The results should be similar to <a href="http://liz-fernandez.github.io/DATA/s-7-1_fastqc.html">this</a>.</p>
<p>This page contains a lot of information broken down into the following sections:</p>
<ol style="list-style-type: decimal">
<li><strong>Basic Statistics</strong> - The basic statistics of the experiment.</li>
<li><strong>Per base sequence quality</strong> - Box diagrams showing the quality of each base.</li>
<li><strong>Per tile sequence quality</strong> - It contains the box (tile) from which each sequence comes. It only appears if the analyzes are made in an Illumina library that retains its original identifiers.</li>
<li><strong>Per sequence quality scores</strong> - It allows to see if a subgroup of sequences has bad quality.</li>
<li><strong>Per base sequence content</strong> - Shows the proportion of each base in each position.</li>
<li><strong>Per sequence GC content</strong> - Compares the observed GC distribution with a modeled GC distribution.</li>
<li><strong>Per base N content</strong> - Indicates how many nucleotides could not be interpreted and are indicated with an N.</li>
<li><strong>Sequence Length Distribution</strong> - Shows the sequence length distribution.</li>
<li><strong>Sequence Duplication Levels</strong> - Indicate how many times each sequence is repeated. It is done only in the first 100,000 sequences.</li>
<li><strong>Overrepresented sequences</strong> - Shows over represented sequences.</li>
<li><strong>Adapter Content</strong> - Shows the content of adapters in the library.</li>
</ol>
<p>Let’s review the results once more by clicking on the <a href="http://liz-fernandez.github.io/DATA/s-7-1_fastqc.html">link</a>.</p>
<p>In general we see that most of the criteria have a green tick of quality control pass, with the exception of per base sequence content, GC content per base and overrepresented sequences.</p>
<p>Although we did not provide this information, the program has inferred the coding ASCII (Sanger / Illumina 1.9) as well as the number of sequences, their size and its GC content.</p>
<p>When we observe the <strong>quality per base</strong>, we see that most of the bases are in the area green or have good quality. Each base is represented by a box diagram that provides a good idea about the distribution of quality scores in all the sequences. It is evident that the quality decreases more markedly at the end of the sequence. This is known as small errors accumulate while the longer the sequence, this is one of the reasons why sequencers based in nucleotide incorporation they have a limit on the maximum length of their readings.</p>
<p>The graph showing the <strong>quality per tile</strong> is almost completely blue showing that the average distribution of errors in the tile is very similar.</p>
<p>The graph of <strong>quality score per sequence</strong> shows that most of the sequences have high scores.</p>
<p>However, the <strong>distribution of nucleotides per base</strong> shows that, at the beginning of the sequence, the distribution is very disparate.</p>
<p>We also observe that:</p>
<ul>
<li>The <strong>GC distribution per sequence</strong> is somewhat different to the hypothetical distribution.</li>
<li>There are few <strong>ambiguous bases (Ns)</strong>.</li>
<li>All sequences have the same <strong>size</strong>.</li>
<li>Levels of <strong>duplication of sequences</strong> are very low.</li>
<li>There are a few <strong>over represented sequences</strong>. Mostly Illumina PCR primers.</li>
<li>There are no <strong>adapters</strong>.</li>
</ul>
<p>When running FastQC, a compressed file called <code>s-7-1_fastqc.zip</code>.</p>
<p>We unpack this file using the following command:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">unzip</span> s-7-1_fastqc.zip</code></pre></div>
<pre class="output"><code>Archive:  s-7-1_fastqc.zip
   creating: s-7-1_fastqc/
   creating: s-7-1_fastqc/Icons/
   creating: s-7-1_fastqc/Images/
  inflating: s-7-1_fastqc/Icons/fastqc_icon.png
  inflating: s-7-1_fastqc/Icons/warning.png
  inflating: s-7-1_fastqc/Icons/error.png
  inflating: s-7-1_fastqc/Icons/tick.png
  inflating: s-7-1_fastqc/summary.txt
  inflating: s-7-1_fastqc/Images/per_base_quality.png
  inflating: s-7-1_fastqc/Images/per_tile_quality.png
  inflating: s-7-1_fastqc/Images/per_sequence_quality.png
  inflating: s-7-1_fastqc/Images/per_base_sequence_content.png
  inflating: s-7-1_fastqc/Images/per_sequence_gc_content.png
  inflating: s-7-1_fastqc/Images/per_base_n_content.png
  inflating: s-7-1_fastqc/Images/sequence_length_distribution.png
  inflating: s-7-1_fastqc/Images/duplication_levels.png
  inflating: s-7-1_fastqc/Images/adapter_content.png
  inflating: s-7-1_fastqc/fastqc_report.html
  inflating: s-7-1_fastqc/fastqc_data.txt
  inflating: s-7-1_fastqc/fastqc.fo</code></pre>
<p>If we enter the newly created directory, we can see the report in plain text format, both the summary:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">cd</span> s-7-1_fastqc
$ <span class="kw">more</span> summary.txt</code></pre></div>
<pre class="output"><code>PASS    Basic Statistics    s-7-1.fastq
PASS    Per base sequence quality   s-7-1.fastq
PASS    Per tile sequence quality   s-7-1.fastq
PASS    Per sequence quality scores s-7-1.fastq
WARN    Per base sequence content   s-7-1.fastq
WARN    Per sequence GC content s-7-1.fastq
PASS    Per base N content  s-7-1.fastq
PASS    Sequence Length Distribution    s-7-1.fastq
PASS    Sequence Duplication Levels s-7-1.fastq
WARN    Overrepresented sequences   s-7-1.fastq
PASS    Adapter Content s-7-1.fastq</code></pre>
<p>and the full report file:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">more</span> fastqc_data.txt</code></pre></div>
<p>We have omitted the content since it is very long. Being able to review the results in flat files is extremely useful when results are in a server that does not have a graphical interface.</p>
<p>FastQC programmers have compiled examples of quality sequencing data diverse Let’s analyze them:</p>
<ul>
<li><a href="http://www.bioinformatics.babraham.ac.uk/projects/fastqc/good_sequence_short_fastqc.html">Good data - Illumina</a></li>
<li><a href="http://www.bioinformatics.babraham.ac.uk/projects/fastqc/bad_sequence_fastqc.html">Bad data - Illumina</a></li>
<li><a href="http://www.bioinformatics.babraham.ac.uk/projects/fastqc/RNA-Seq_fastqc.html">Dimer contamination</a></li>
<li><a href="http://www.bioinformatics.babraham.ac.uk/projects/fastqc/small_rna_fastqc.html">Small RNAs with read through the adaptor</a></li>
</ul>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2 id="how-valid-is-our-analysis"><span class="glyphicon glyphicon-pencil"></span>How valid is our analysis?</h2>
</div>
<div class="panel-body">
<p>Since the data we used only less than 200,000 sequences, can we trust that the complete data will have similar quality? Why or why not?</p>
</div>
</section>
<section class="challenge panel panel-success">
<div class="panel-heading">
<h2 id="how-do-the-rest-of-the-files-look"><span class="glyphicon glyphicon-pencil"></span>How do the rest of the files look?</h2>
</div>
<div class="panel-body">
<p>Obtain the fastQC report html files for all other three fastq files.</p>
</div>
</section>
<h2 id="cleaning-the-sequences">Cleaning the sequences</h2>
<p>There are a number of tools to clean sequences and different researchers have different preferences. How with other sequencing problems there is a active development of programs for this purpose. When the data is of decent quality there is no need to carry out this step for variant annotation.</p>
<p>Here are some examples of programs you can use in case your data is not great.</p>
<ul>
<li><a href="http://www.usadellab.org/cms/?page=trimmomatic">Trimmomatic</a></li>
<li><a href="https://cutadapt.readthedocs.io/">cutadapt</a></li>
</ul>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="mailto:selene.fernandez.valverde@gmail.com">Contacto</a>
        <a class="label swc-blue-bg" href="LICENSE.html">Licencia</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
  </body>
</html>
